namespace = coup

# LIST OF COUP ACTION CHAINS
#1XX	Military Storms Palace/Bunker
#2XX	Internal Security Turned
#3XX	Liege Arrests Target
#4XX	Target's Lover Lays Trap
#5XX	Treasurer Steals State Funds
# ANATOMY OF COUP ACTION CHAINS
#X00	Planning Event
#X01	Planning Event - Inform Plot Leader
#X02	Bad Flag Deletion
#X03	Bad Flag Deletion - Inform Plot Leader
#X04	First Coup Action - Inform Acting Member
#X05	First Coup Action - Bounce to Get Target
#X06	First Coup Action - Resolve Action
#X07	First Coup Action - Success - Inform Actor
#X08	First Coup Action - Success - Inform Target
#X09	First Coup Action - Success - Inform Plot Leader
#X10	First Coup Action - Success - Inform Other Plotters
#X11	First Coup Action - Success - Inform Bystanders
#X12	First Coup Action - Failure - Inform Actor
#X13	First Coup Action - Failure - Inform Target
#X14	First Coup Action - Failure - Inform Plot Leader
#X15	First Coup Action - Failure - Inform Other Plotters
#X16	First Coup Action - Failure - Inform Bystanders
#X17	Followup Action - Inform Acting Member
#X18	Followup Action - Bounce to Get Target
#X19	Followup Action - Resolve Action
#X20	Followup Action - Success - Inform Actor
#X21	Followup Action - Success - Inform Target
#X22	Followup Action - Success - Inform Plot Leader
#X23	Followup Action - Success - Inform Other Plotters
#X24	Followup Action - Success - Inform Bystanders
#X25	Followup Action - Failure - Inform Actor
#X26	Followup Action - Failure - Inform Target
#X27	Followup Action - Failure - Inform Plot Leader
#X28	Followup Action - Failure - Inform Other Plotters
#X29	Followup Action - Failure - Inform Bystanders
# Many of these are redunant, but need to be different for flavor reasons.
# OTHER IMPORTANT COUP EVENTS
#5000	Initiate Coup
#5100	Resolve Captured Coup Target
#5200	Coup Leader Delivers Ultimatum
#5300	Coup Successful
#5500	Choose next coup action

# 1XX - MILITARY STORMS PALACE
# Special events for this chain:
#130	First Coup Action - Military vassals of the Target get a chance to intervene
#132	First Coup Action - Success - Inform Interveners
#133	First Coup Action - Intervention - Inform Actor
#134	First Coup Action - Intervention - Inform Intervener
#135	First Coup Action - Intervention - Inform Target
#136	First Coup Action - Intervention - Inform Plot Leader
#137	First Coup Action - Intervention - Inform Other Plotters
#138	First Coup Action - Intervention - Inform Bystanders
#139	Followup Action - Military vassals of the Target get a chance to intervene
#140	Followup Action - Success - Inform Interveners
#141	Followup Action - Intervention - Inform Actor
#142	Followup Action - Intervention - Inform Intervener
#143	Followup Action - Intervention - Inform Target
#144	Followup Action - Intervention - Inform Plot Leader
#145	Followup Action - Intervention - Inform Other Plotters
#146	Followup Action - Intervention - Inform Bystanders
character_event = {
	id = coup.100
	desc = "EVTDESCCOUP100"
	picture = GFX_evt_cabal
	
	min_age = 16
	only_rulers = yes
	capable_only = yes
	
	trigger = {
		OR = {
			has_plot = plot_coup
			has_plot = plot_justified_coup
			any_backed_character = {
				OR = {
					has_plot = plot_coup
					has_plot = plot_justified_coup
				}
				same_liege = ROOT
			}
		}
		NOT = { has_character_flag = flag_coup_plan_military }
		prisoner = no
		
		# Must have a military command, stationed within at most two jumps of the capital
		is_feudal = yes
		liege = {
			capital_scope = {
				OR = {
					ROOT = { has_job_title = job_marshal }
					any_province_lord = { character = ROOT }
					any_neighbor_province = {
						OR = {
							any_province_lord = { character = ROOT }
							any_neighbor_province = { any_province_lord = { character = ROOT } }
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 30
		
		modifier = {
			factor = 0.5
			trait = genius
		}
		modifier = {
			factor = 0.8
			trait = quick
		}
		modifier = {
			factor = 1.25
			trait = slow
		}
		modifier = {
			factor = 2
			trait = imbecile
		}
		
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.1
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.2
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.3
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.4
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.5
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.6
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.7
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.8
		}
		modifier = {
			factor = 0.8
			relative_power_to_liege = 0.9
		}
	}
	
	option = {
		name = "EVTOPTACOUP100"
		set_character_flag = flag_coup_plan_military
		any_backed_character = {
			limit = {
				OR = {
					has_plot = plot_coup
					has_plot = plot_justified_coup
				}
				same_liege = ROOT
			}
			letter_event = { id = coup.101 tooltip = "EVTTOOLTIPCOUP101" }
		}
	}
}

letter_event = {
	id = coup.101
	desc = "EVTDESCCOUP101"
	is_triggered_only = yes
	
	option = { name = "EVTOPTACOUP101" }
}

character_event = {
	id = coup.102
	desc = "EVTDESCCOUP102"
	picture = GFX_evt_cabal
	
	trigger = {
		OR = {
			has_character_flag = flag_coup_plan_military
			has_character_flag = flag_coup_action_military
		}
		NOT = {
			AND = {
				OR = {
					has_plot = plot_coup
					has_plot = plot_justified_coup
					any_backed_character = {
						OR = {
							has_plot = plot_coup
							has_plot = plot_justified_coup
							same_liege = ROOT
						}
					}
				}
				is_feudal = yes
				liege = {
					capital_scope = {
						OR = {
							ROOT = { has_job_title = job_marshal }
							any_province_lord = { character = ROOT }
							any_neighbor_province = {
								OR = {
									any_province_lord = { character = ROOT }
									any_neighbor_province = { any_province_lord = { character = ROOT }  }
								}
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTCONFIRM"
		clr_character_flag = flag_coup_plan_military
		clr_character_flag = flag_coup_action_military
		any_backed_character = {
			limit = {
				OR = {
					has_plot = plot_coup
					has_plot = plot_justified_coup
				}
				same_liege = ROOT
			}
			character_event = { id = coup.103 tooltip = "EVTTOOLTIPCOUP103" }
		}
	}
}

character_event = {
	id = coup.103
	desc = "EVTDESCCOUP103"
	picture = GFX_evt_cabal
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

character_event = {
	id = coup.104
	desc = "EVTDESCCOUP104"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		trigger = { has_character_flag = flag_coup_leader } # Is the coup leader
		name = "EVTOPTACOUP104"
		clr_character_flag = flag_coup_plan_military
		set_character_flag = flag_coup_action_military
		plot_target_char = {
			character_event = { id = coup.105 tooltip = "EVTTOOLTIPCOUP105" days = 1 }
			hidden_tooltip = { any_vassal = { character_event = { id = coup.130 } } } # Possible chance to intercept
		}
	}
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } } # Is a coup supporter
		name = "EVTOPTACOUP104"
		clr_character_flag = flag_coup_plan_military
		set_character_flag = flag_coup_action_military
		random_backed_character = {
			limit = { has_character_flag = flag_coup_leader }
			plot_target_char = {
				plot_target_char = {
					character_event = { id = coup.105 tooltip = "EVTTOOLTIPCOUP105" days = 1 }
					hidden_tooltip = { any_vassal = { character_event = { id = coup.130 } } } # Possible chance to intercept
				}
			}
		}
	}
}

character_event = {
	id = coup.130
	desc = "EVTDESCCOUP130"
	picture = GFX_command_center
	hide_from = yes
	is_triggered_only = yes
	
	trigger = {
		is_ruler = yes
		is_feudal = yes
		relative_power_to_liege = 0.1
		
		NOT = { has_character_flag = flag_coup_member }
		NOT = { has_character_flag = flag_coup_leader }
		
		# Needs to have at least as much intrigue as FROM
		intrigue = FROM
		
		# Must be within two jumps of the capital
		liege = {
			capital_scope = {
				OR = {
					ROOT = { has_job_title = job_marshal }
					any_province_lord = { character = ROOT }
					any_neighbor_province = {
						OR = {
							any_province_lord = { character = ROOT }
							any_neighbor_province = { any_province_lord = { character = ROOT } }
						}
					}
				}
			}
		}
		
		prisoner = no
		age = 16
		NOT = { trait = incapable }
	}
	
	option = {
		name = "EVTOPTACOUP130"
		set_character_flag = flag_coup_interceptor
		ai_chance = {
			factor = 100
			
			# Opinion Effects
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 100 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 90 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 80 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 70 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 50 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 30 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 10 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -9 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -19 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -29 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -39 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -49 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -59 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -69 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -79 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -89 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -99 } }
			}
			
			# Moral Authority - Thwarting Coups is a Civic Dury
			modifier = {
				factor = 2
				liege = {
					religion = ROOT
					OR = {
						religion_authority = 0.25
						ROOT = { trait = radical }
					}
				}
			}
			modifier = {
				factor = 2
				liege = { religion_authority = 0.5 }
			}
			modifier = {
				factor = 2
				liege = { religion_authority = 0.75 }
			}
			
			# Favors
			modifier = {
				factor = 5
				reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor }
			}
			modifier = {
				factor = 2
				reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor }
			}
			modifier = {
				factor = 5
				NOT = { has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor } }
				NOT = { reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor } }
				trait = ambitious
			}
		}
	}
	
	option = {
		name = "EVTOPTBCOUP130"
		ai_chance = { factor = 100 }
	}
}

character_event = {
	id = coup.105
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { e_rebels = { holder_scope = { character_event = { id = coup.106 } } } }
}

# Resolve Coup Action - Military Coup
character_event = {
	id = coup.106
	hide_window = yes
	is_triggered_only = yes
	
	option = {
		# Coup Action Successful
		FROM = { FROM = { character_event = { id = coup.107 } } }
		ai_chance = {
			factor = 100
			# Coup commander's martial skill
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 1 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 2 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 3 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 4 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 5 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 6 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 7 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 8 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 9 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 10 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 11 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 12 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 13 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 14 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 15 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 16 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 17 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 18 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 19 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 20 } }
			}
			
			# Target and loyalists' martial
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 1
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 2
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 3
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 4
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 5
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 6
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 7
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 8
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 9
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 10
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 11
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 12
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 13
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 14
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 15
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 16
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 17
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 18
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 19
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 20
						}
					}
				}
			}
			
			# Proximity of coup commander to target
			modifier = {
				factor = 2
				OR = {
					FROM = { FROM = { has_job_title = job_marshal } }
					FROM = { capital_scope = { any_province_lord = { character = FROMFROM } } }
				}
			}
			modifier = {
				factor = 2
				OR = {
					FROM = { FROM = { has_job_title = job_marshal } }
					FROM = {
						capital_scope = {
							OR = {
								any_province_lord = { character = FROMFROM }
								any_neighbor_province = { any_province_lord = { character = FROMFROM } }
							}
						}
					}
				}
			}
			
			# Proximity of intervener to target
			modifier = {
				factor = 2
				FROM = {
					OR = {
						any_vassal = {
							has_character_flag = flag_coup_intervener
							has_job_title = job_marshal
						}
						capital_scope = {
							any_province_lord = {
								liege = { character = FROM }
								has_character_flag = flag_coup_intervener
							}
						}
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					OR = {
						any_vassal = {
							has_character_flag = flag_coup_intervener
							has_job_title = job_marshal
						}
						capital_scope = {
							OR = {
								any_province_lord = {
									liege = { character = FROM }
									has_character_flag = flag_coup_intervener
								}
								any_neighbor_province = {
									any_province_lord = {
										liege = { character = FROM }
										has_character_flag = flag_coup_intervener
									}
								}
							}
						}
					}
				}
			}
		}
	}
	option = {
		# Coup Action Failed
		# Coup foiled solely by liege
		if = {
			limit = { FROM = { NOT = { any_vassal = { has_character_flag = flag_coup_intervener } } } }
			FROM = { FROM = { character_event = { id = coup.112 } } }
		}
		# Coup foiled by heroic intervention
		if = {
			limit = { FROM = { any_vassal = { has_character_flag = flag_coup_intervener } } }
			FROM = { FROM = { character_event = { id = coup.133 } } }
		}
		ai_chance = { factor = 100 }
	}
}

# Successful military coup - Inform Actor
character_event = {
	id = coup.107
	desc = "EVTDESCCOUP107"
	picture = GFX_evt_military_coup
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	# I am the coup leader
	option = {
		trigger = { has_character_flag = flag_coup_leader }
		name = "EVTOPTACOUP107"
		FROM = {
			FROM = {
				# Target is captured
				imprison = ROOT
			}
		}
		character_event = { id = coup.5100 tooltip = "EVTTOOLTIPCOUP5100" }
		hidden_tooltip = {
			FROM = {
				FROM = {
					character_event = { id = coup.108 }
					liege = { character_event = { id = coup.111 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.111 }
					}
					any_vassal = {
						limit = { has_character_flag = flag_coup_intervener }
						character_event = { id = coup.132 }
					}
				}
			}
			any_plot_backer = { character_event = { id = coup.110 } }
		}
	}
	
	# I am not the coup leader
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP107"
		random_backed_character = {
			limit = {
				has_character_flag = flag_coup_leader
				plot_target_char = { character = FROMFROM }
			}
			plot_target_char = {
				imprison = PREV
				hidden_tooltip = {
					character_event = { id = coup.108 }
					liege = { character_event = { id = coup.111 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.111 }
					}
					any_vassal = {
						limit = { has_character_flag = flag_coup_intervener }
						character_event = { id = coup.132 }
					}
				}
			}
			hidden_tooltip = {
				any_plot_backer = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = coup.110 }
				}
			}
			letter_event = { id = coup.109 tooltip = "EVTTOOLTIPCOUP109" }
		}
	}
}

# Military Coup Succeeds - Inform Target
character_event = {
	id = coup.108
	desc = "EVTDESCCOUP108"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP108"
		opinion = { who = FROM modifier = opinion_attempted_coup }
	}
}

# Military Coup Succeeds - Inform Plot Leader
letter_event = {
	id = coup.109
	desc = "EVTDESCCOUP109"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP109"
		opinion = { who = FROM modifier = opinion_captured_coup_target }
		character_event = { id = coup.5100 tooltip = "EVTTOOLTIPCOUP5100" }
	}
}

# Initial military coup succeeds - Inform Other Plotters
character_event = {
	id = coup.110
	desc = "EVTDESCCOUP110"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Initial military coup succeeds - Inform Bystandards
character_event = {
	id = coup.111
	desc = "EVTDESCCOUP111"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Initial military coup succeeds - Inform Interveners
character_event = {
	id = coup.132
	desc = "EVTDESCCOUP132"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP132"
		clr_character_flag = flag_coup_intervener
	}
}

# Initial military coup fails without intervention - inform commander
character_event = {
	id = coup.112
	desc = "EVTDESCCOUP112"
	picture = GFX_evt_military_coup
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	# I am the coup leader
	option = {
		trigger = { has_character_flag = flag_coup_leader }
		name = "EVTOPTACOUP107"
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
		FROM = { FROM = { character_event = { id = coup.113 tooltip = "EVTTOOLTIPCOUP113" } } }
		hidden_tooltip = {
			FROM = {
				FROM = {
					liege = { character_event = { id = coup.116 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.116 }
					}
				}
			}
			any_plot_backer = { character_event = { id = coup.115 } }
		}
	}
	
	# I am not the coup leader
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP107"
		random_backed_character = {
			limit = {
				has_character_flag = flag_coup_leader
				plot_target_char = { character = FROMFROM }
			}
			plot_target_char = { character_event = { id = coup.113 tooltip = "EVTTOOLTIPCOUP113" } }
			letter_event = { id = coup.114 tooltip = "EVTTOOLTIPCOUP114" }
			hidden_tooltip = {
				plot_target_char = {
					liege = { character_event = { id = coup.116 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.116 }
					}
				}
				any_plot_backer = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = coup.115 }
				}
			}
		}
	}
}

# Initial military coup fails without intervention - inform target
character_event = {
	id = coup.113
	desc = "EVTDESCCOUP113"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP113"
		opinion = { who = FROM modifier = opinion_attempted_coup }
	}
}

# Initial military coup fails without intervention - inform plot leader
letter_event = {
	id = coup.114
	desc = "EVTDESCCOUP114"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP114"
		opinion = { who = FROM modifier = opinion_failed_to_capture_coup_target }
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
	}
}

# Initial military coup fails without intervention - inform plot backers
character_event = {
	id = coup.115
	desc = "EVTDESCCOUP115"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Initial military coup fails without intervention - inform bystanders
character_event = {
	id = coup.116
	desc = "EVTDESCCOUP115"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Initial military coup fails due to intervention - inform actor
character_event = {
	id = coup.133
	desc = "EVTDESCCOUP133"
	picture = GFX_evt_space_battle
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	option = {
		name = "EVTOPTACOUP133"
		FROM = {
			FROM = {
				# Select the successful intervener - must have highest martial among interveners
				random_vassal = {
					limit = {
						has_character_flag = flag_coup_intervener
						liege = {
							NOT = {
								any_vassal = {
									has_character_flag = flag_coup_intervener
									attribute_diff = {
										character = PREVPREV
										attribute = martial
										value = 1
									}
								}
							}
						}
					}
					character_event = { id = coup.134 tooltip = "EVTTOOLTIPCOUP134" }
				}
			}
		}
	}
}

# Initial military coup fails due to intervention - inform Intervener
character_event = {
	id = coup.134
	desc = "EVTDESCCOUP134"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		# FROM is coup leader
		trigger = { FROM = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP134"
		clr_character_flag = flag_coup_intervener
		set_character_flag = flag_coup_loyalist # Character is now locked into defending against all future attacks in this coup
		
		# Intervener's reward - prestige and a heroic reputation
		prestige = 250
		religion_authority = { modifier = thwarted_coup }
		liege = { opinion = { who = ROOT modifier = opinion_thwarted_coup } }
		if = {
			limit = {
				liege = {
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
				}
			}
			custom_tooltip = {
				text = "EVTTOOLTIPWILLOWEFAVOR"
				hidden_tooltip = {
					reverse_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
					reverse_opinion = { who = ROOT modifier = opinion_favor_type_military }
				}
			}
		}
		if = {
			limit = { liege = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } } }
			remove_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
			letter_event = { id = favor.100 tooltip = "EVTTOOLTIPFAVORFULFILLED" }
		}
		hidden_tooltip = {
			liege = {
				character_event = { id = coup.135 }
				liege = { character_event = { id = coup.138 } }
				any_vassal = {
					limit = {
						NOT = { has_character_flag = flag_coup_member }
						NOT = { has_character_flag = flag_coup_leader }
						NOT = { character = ROOT }
					}
					clr_character_flag = flag_coup_intervener
					character_event = { id = coup.138 }
				}
			}
		}
		FROM = {
			opinion = { who = ROOT modifier = opinion_foiled_my_plans }
			hidden_tooltip = {
				character_event = { id = coup.5500 }
				any_plot_backer = { character_event = { id = coup.137 } }
			}
		}
	}
	
	option = {
		# FROM is not coup leader
		trigger = { FROM = { NOT = { has_character_flag = flag_coup_leader } } }
		name = "EVTOPTACOUP134"
		
		# Intervener's reward - prestige and a heroic reputation
		prestige = 250
		religion_authority = { modifier = thwarted_coup }
		liege = { opinion = { who = ROOT modifier = opinion_thwarted_coup } }
		if = {
			limit = {
				liege = {
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
				}
			}
			custom_tooltip = {
				text = "EVTTOOLTIPWILLOWEFAVOR"
				hidden_tooltip = {
					reverse_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
					reverse_opinion = { who = ROOT modifier = opinion_favor_type_military }
				}
			}
		}
		if = {
			limit = { liege = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } } }
			liege = {
				remove_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
				letter_event = { id = favor.100 tooltip = "EVTTOOLTIPFAVORFULFILLED" }
			}
		}
		hidden_tooltip = {
			liege = {
				character_event = { id = coup.135 }
				liege = { character_event = { id = coup.138 } }
				any_vassal = {
					limit = {
						NOT = { has_character_flag = flag_coup_member }
						NOT = { has_character_flag = flag_coup_leader }
						NOT = { character = ROOT }
					}
					clr_character_flag = flag_coup_intervener
					character_event = { id = coup.138 }
				}
			}
		}
		FROM = {
			opinion = { who = ROOT modifier = opinion_foiled_my_plans }
			any_backed_character = {
				limit = {
					has_character_flag = flag_coup_leader
					OR = {
						has_plot = plot_coup
						has_plot = plot_justified_coup
					}
					plot_target_char = { any_vassal = { character = ROOT } }
				}
				opinion = { who = ROOT modifier = opinion_foiled_my_plans }
				hidden_tooltip = {
					letter_event = { id = coup.136 }
					any_plot_backer = {
						limit = { NOT = { character = FROM } }
						character_event = { id = coup.137 }
					}
				}
			}
		}
	}
}

# Coup fails due to intervention - inform target
character_event = {
	id = coup.135
	desc = "EVTDESCCOUP135"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP135"
		opinion = { who = FROMFROM modifier = opinion_attempted_coup }
	}
}

# Inform plot leader
letter_event = {
	id = coup.136
	desc = "EVTDESCCOUP136"
	show_from_from = yes
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP136"
		opinion = { who = FROMFROM modifier = opinion_failed_to_capture_coup_target }
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
	}
}
# Inform other plot backers
character_event = {
	id = coup.137
	desc = "EVTDESCCOUP137"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTCONFIRM"
	}
}
# Inform bystanders
character_event = {
	id = coup.138
	desc = "EVTDESCCOUP137"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# FOLLOW-UP MILITARY COUP
character_event = {
	id = coup.117
	desc = "EVTDESCCOUP117"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		trigger = { has_character_flag = flag_coup_leader } # Is the coup leader
		name = "EVTOPTACOUP104"
		clr_character_flag = flag_coup_plan_military
		set_character_flag = flag_coup_action_military
		plot_target_char = {
			character_event = { id = coup.118 tooltip = "EVTTOOLTIPCOUP105" days = 1 }
			hidden_tooltip = { any_vassal = { character_event = { id = coup.139 } } } # Possible chance to intercept
		}
	}
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } } # Is a coup supporter
		name = "EVTOPTACOUP104"
		clr_character_flag = flag_coup_plan_military
		set_character_flag = flag_coup_action_military
		random_backed_character = {
			limit = { has_character_flag = flag_coup_leader }
			plot_target_char = {
				plot_target_char = {
					character_event = { id = coup.118 tooltip = "EVTTOOLTIPCOUP105" days = 1 }
					hidden_tooltip = { any_vassal = { character_event = { id = coup.139 } } } # Possible chance to intercept
				}
			}
		}
	}
}

# Inform loyalists of a potential coup in progress
character_event = {
	id = coup.139
	desc = "EVTDESCCOUP139"
	picture = GFX_command_center
	hide_from = yes
	is_triggered_only = yes
	
	trigger = {
		is_ruler = yes
		is_feudal = yes
		relative_power_to_liege = 0.1
		
		NOT = { has_character_flag = flag_coup_member }
		NOT = { has_character_flag = flag_coup_leader }
		
		# Needs to have at least as much intrigue as FROM
		intrigue = FROM
		
		# Must be within two jumps of the capital
		liege = {
			capital_scope = {
				OR = {
					ROOT = { has_job_title = job_marshal }
					any_province_lord = { character = ROOT }
					any_neighbor_province = {
						OR = {
							any_province_lord = { character = ROOT }
							any_neighbor_province = { any_province_lord = { character = ROOT } }
						}
					}
				}
			}
		}
		
		prisoner = no
		age = 16
		NOT = { trait = incapable }
	}
	
	option = {
		name = "EVTOPTACOUP139"
		set_character_flag = flag_coup_interceptor
		ai_chance = {
			factor = 100
			
			# Opinion Effects
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 100 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 90 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 80 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 70 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 50 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 30 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = LIEGE value = 10 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -9 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -19 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -29 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -39 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -49 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -59 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -69 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -79 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -89 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = LIEGE value = -99 } }
			}
			
			# Moral Authority - Thwarting Coups is a Civic Dury
			modifier = {
				factor = 2
				liege = {
					religion = ROOT
					OR = {
						religion_authority = 0.25
						ROOT = { trait = radical }
					}
				}
			}
			modifier = {
				factor = 2
				liege = { religion_authority = 0.5 }
			}
			modifier = {
				factor = 2
				liege = { religion_authority = 0.75 }
			}
			
			# Favors
			modifier = {
				factor = 5
				reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor }
			}
			modifier = {
				factor = 2
				reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor }
			}
			modifier = {
				factor = 5
				NOT = { has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor } }
				NOT = { reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_owes_me_a_favor } }
				trait = ambitious
			}
		}
	}
	
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_loyalist } } # Can't go back after already committing to intervene
		name = "EVTOPTBCOUP130"
		ai_chance = { factor = 100 }
	}
}

character_event = {
	id = coup.118
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { e_rebels = { holder_scope = { character_event = { id = coup.119 } } } }
}

# Resolve Coup Action - Military Coup
character_event = {
	id = coup.119
	hide_window = yes
	is_triggered_only = yes
	
	option = {
		# Coup Action Successful
		FROM = { FROM = { character_event = { id = coup.120 } } }
		ai_chance = {
			factor = 25 # Subsequent actions less likely to succeed due to lack of surprise advantage
			# Coup commander's martial skill
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 1 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 2 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 3 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 4 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 5 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 6 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 7 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 8 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 9 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 10 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 11 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 12 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 13 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 14 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 15 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 16 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 17 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 18 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 19 } }
			}
			modifier = {
				factor = 1.25
				FROM = { FROM = { martial = 20 } }
			}
			
			# Target and loyalists' martial
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 1
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 2
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 3
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 4
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 5
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 6
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 7
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 8
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 9
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 10
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 11
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 12
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 13
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 14
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 15
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 16
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 17
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 18
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 19
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					OR = {
						martial = 1
						any_vassal = {
							has_character_flag = flag_coup_interceptor
							martial = 20
						}
					}
				}
			}
			
			# Proximity of coup commander to target
			modifier = {
				factor = 2
				OR = {
					FROM = { FROM = { has_job_title = job_marshal } }
					FROM = { capital_scope = { any_province_lord = { character = FROMFROM } } }
				}
			}
			modifier = {
				factor = 2
				OR = {
					FROM = { FROM = { has_job_title = job_marshal } }
					FROM = {
						capital_scope = {
							OR = {
								any_province_lord = { character = FROMFROM }
								any_neighbor_province = { any_province_lord = { character = FROMFROM } }
							}
						}
					}
				}
			}
			
			# Proximity of intervener to target
			modifier = {
				factor = 2
				FROM = {
					OR = {
						any_vassal = {
							has_character_flag = flag_coup_intervener
							has_job_title = job_marshal
						}
						capital_scope = {
							any_province_lord = {
								liege = { character = FROM }
								has_character_flag = flag_coup_intervener
							}
						}
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					OR = {
						any_vassal = {
							has_character_flag = flag_coup_intervener
							has_job_title = job_marshal
						}
						capital_scope = {
							OR = {
								any_province_lord = {
									liege = { character = FROM }
									has_character_flag = flag_coup_intervener
								}
								any_neighbor_province = {
									any_province_lord = {
										liege = { character = FROM }
										has_character_flag = flag_coup_intervener
									}
								}
							}
						}
					}
				}
			}
		}
	}
	option = {
		# Coup Action Failed
		# Coup foiled solely by liege
		if = {
			limit = { FROM = { NOT = { any_vassal = { has_character_flag = flag_coup_intervener } } } }
			FROM = { FROM = { character_event = { id = coup.125 } } }
		}
		# Coup foiled by heroic intervention
		if = {
			limit = { FROM = { any_vassal = { has_character_flag = flag_coup_intervener } } }
			FROM = { FROM = { character_event = { id = coup.141 } } }
		}
		ai_chance = { factor = 100 }
	}
}

# Successful military coup - Inform Actor
character_event = {
	id = coup.120
	desc = "EVTDESCCOUP120"
	picture = GFX_evt_military_coup
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	# I am the coup leader
	option = {
		trigger = { has_character_flag = flag_coup_leader }
		name = "EVTOPTACOUP120"
		FROM = {
			FROM = {
				# Target is captured
				imprison = ROOT
			}
		}
		character_event = { id = coup.5100 tooltip = "EVTTOOLTIPCOUP5100" }
		hidden_tooltip = {
			FROM = {
				FROM = {
					character_event = { id = coup.121 }
					liege = { character_event = { id = coup.124 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.124 }
					}
					any_vassal = {
						limit = { has_character_flag = flag_coup_intervener }
						character_event = { id = coup.140 }
					}
				}
			}
			any_plot_backer = { character_event = { id = coup.123 } }
		}
	}
	
	# I am not the coup leader
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP120"
		random_backed_character = {
			limit = {
				has_character_flag = flag_coup_leader
				plot_target_char = { character = FROMFROM }
			}
			plot_target_char = {
				imprison = PREV
				hidden_tooltip = {
					character_event = { id = coup.121 }
					liege = { character_event = { id = coup.124 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.124 }
					}
					any_vassal = {
						limit = { has_character_flag = flag_coup_intervener }
						character_event = { id = coup.140 }
					}
				}
			}
			hidden_tooltip = {
				any_plot_backer = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = coup.123 }
				}
			}
			letter_event = { id = coup.122 tooltip = "EVTTOOLTIPCOUP109" }
		}
	}
}

# Military Coup Succeeds - Inform Target
character_event = {
	id = coup.121
	desc = "EVTDESCCOUP121"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP121"
		opinion = { who = FROM modifier = opinion_attempted_coup }
	}
}

# Military Coup Succeeds - Inform Plot Leader
letter_event = {
	id = coup.122
	desc = "EVTDESCCOUP122"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP109"
		opinion = { who = FROM modifier = opinion_captured_coup_target }
		character_event = { id = coup.5100 tooltip = "EVTTOOLTIPCOUP5100" }
	}
}

# Followup military coup succeeds - Inform Other Plotters
character_event = {
	id = coup.123
	desc = "EVTDESCCOUP123"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Followup military coup succeeds - Inform Bystandards
character_event = {
	id = coup.124
	desc = "EVTDESCCOUP124"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Followup military coup succeeds - Inform Interveners
character_event = {
	id = coup.140
	desc = "EVTDESCCOUP132"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP132"
		clr_character_flag = flag_coup_intervener
	}
}

# Followup military coup fails without intervention - inform commander
character_event = {
	id = coup.125
	desc = "EVTDESCCOUP125"
	picture = GFX_evt_military_coup
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	# I am the coup leader
	option = {
		trigger = { has_character_flag = flag_coup_leader }
		name = "EVTOPTACOUP107"
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
		FROM = { FROM = { character_event = { id = coup.126 tooltip = "EVTTOOLTIPCOUP126" } } }
		hidden_tooltip = {
			FROM = {
				FROM = {
					liege = { character_event = { id = coup.129 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.129 }
					}
				}
			}
			any_plot_backer = { character_event = { id = coup.128 } }
		}
	}
	
	# I am not the coup leader
	option = {
		trigger = { NOT = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP107"
		random_backed_character = {
			limit = {
				has_character_flag = flag_coup_leader
				plot_target_char = { character = FROMFROM }
			}
			plot_target_char = { character_event = { id = coup.126 tooltip = "EVTTOOLTIPCOUP126" } }
			letter_event = { id = coup.127 tooltip = "EVTTOOLTIPCOUP127" }
			hidden_tooltip = {
				plot_target_char = {
					liege = { character_event = { id = coup.129 } }
					any_vassal = {
						limit = {
							NOT = { has_character_flag = flag_coup_member }
							NOT = { has_character_flag = flag_coup_leader }
							NOT = { has_character_flag = flag_coup_intervener }
						}
						character_event = { id = coup.129 }
					}
				}
				any_plot_backer = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = coup.128 }
				}
			}
		}
	}
}

# Followup military coup fails without intervention - inform target
character_event = {
	id = coup.126
	desc = "EVTDESCCOUP126"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP126"
		opinion = { who = FROM modifier = opinion_attempted_coup }
	}
}

# Followup military coup fails without intervention - inform plot leader
letter_event = {
	id = coup.127
	desc = "EVTDESCCOUP127"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP114"
		opinion = { who = FROM modifier = opinion_failed_to_capture_coup_target }
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
	}
}

# Followup military coup fails without intervention - inform plot backers
character_event = {
	id = coup.128
	desc = "EVTDESCCOUP128"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Followup military coup fails without intervention - inform bystanders
character_event = {
	id = coup.129
	desc = "EVTDESCCOUP128"
	notification = yes
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# Followup military coup fails due to intervention - inform actor
character_event = {
	id = coup.141
	desc = "EVTDESCCOUP141"
	picture = GFX_evt_space_battle
	show_from_from = yes
	is_triggered_only = yes
	
	immediate = { clr_character_flag = flag_coup_action_military }
	
	option = {
		name = "EVTOPTACOUP141"
		FROM = {
			FROM = {
				# Select the successful intervener - must have highest martial among interveners
				random_vassal = {
					limit = {
						has_character_flag = flag_coup_intervener
						liege = {
							NOT = {
								any_vassal = {
									has_character_flag = flag_coup_intervener
									attribute_diff = {
										character = PREVPREV
										attribute = martial
										value = 1
									}
								}
							}
						}
					}
					character_event = { id = coup.142 tooltip = "EVTTOOLTIPCOUP142" }
				}
			}
		}
	}
}

# Initial military coup fails due to intervention - inform Intervener
character_event = {
	id = coup.142
	desc = "EVTDESCCOUP142"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		# FROM is coup leader
		trigger = { FROM = { has_character_flag = flag_coup_leader } }
		name = "EVTOPTACOUP142"
		clr_character_flag = flag_coup_intervener
		
		# Intervener's reward - prestige and a heroic reputation
		prestige = 250
		religion_authority = { modifier = thwarted_coup }
		liege = { opinion = { who = ROOT modifier = opinion_thwarted_coup } }
		if = {
			limit = {
				liege = {
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
				}
			}
			custom_tooltip = {
				text = "EVTTOOLTIPWILLOWEFAVOR"
				hidden_tooltip = {
					reverse_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
					reverse_opinion = { who = ROOT modifier = opinion_favor_type_military }
				}
			}
		}
		if = {
			limit = { liege = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } } }
			remove_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
			letter_event = { id = favor.100 tooltip = "EVTTOOLTIPFAVORFULFILLED" }
		}
		hidden_tooltip = {
			liege = {
				character_event = { id = coup.143 }
				liege = { character_event = { id = coup.146 } }
				any_vassal = {
					limit = {
						NOT = { has_character_flag = flag_coup_member }
						NOT = { has_character_flag = flag_coup_leader }
						NOT = { character = ROOT }
					}
					clr_character_flag = flag_coup_intervener
					character_event = { id = coup.146 }
				}
			}
		}
		FROM = {
			opinion = { who = ROOT modifier = opinion_foiled_my_plans }
			hidden_tooltip = {
				character_event = { id = coup.5500 }
				any_plot_backer = { character_event = { id = coup.145 } }
			}
		}
	}
	
	option = {
		# FROM is not coup leader
		trigger = { FROM = { NOT = { has_character_flag = flag_coup_leader } } }
		name = "EVTOPTACOUP134"
		
		# Intervener's reward - prestige and a heroic reputation
		prestige = 250
		religion_authority = { modifier = thwarted_coup }
		liege = { opinion = { who = ROOT modifier = opinion_thwarted_coup } }
		if = {
			limit = {
				liege = {
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } }
				}
			}
			custom_tooltip = {
				text = "EVTTOOLTIPWILLOWEFAVOR"
				hidden_tooltip = {
					reverse_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
					reverse_opinion = { who = ROOT modifier = opinion_favor_type_military }
				}
			}
		}
		if = {
			limit = { liege = { has_opinion_modifier = { who = ROOT modifier = opinion_owes_me_a_favor } } }
			liege = {
				remove_opinion = { who = ROOT modifier = opinion_owes_me_a_favor }
				letter_event = { id = favor.100 tooltip = "EVTTOOLTIPFAVORFULFILLED" }
			}
		}
		hidden_tooltip = {
			liege = {
				character_event = { id = coup.143 }
				liege = { character_event = { id = coup.146 } }
				any_vassal = {
					limit = {
						NOT = { has_character_flag = flag_coup_member }
						NOT = { has_character_flag = flag_coup_leader }
						NOT = { character = ROOT }
					}
					clr_character_flag = flag_coup_intervener
					character_event = { id = coup.146 }
				}
			}
		}
		FROM = {
			opinion = { who = ROOT modifier = opinion_foiled_my_plans }
			any_backed_character = {
				limit = {
					has_character_flag = flag_coup_leader
					OR = {
						has_plot = plot_coup
						has_plot = plot_justified_coup
					}
					plot_target_char = { any_vassal = { character = ROOT } }
				}
				opinion = { who = ROOT modifier = opinion_foiled_my_plans }
				hidden_tooltip = {
					letter_event = { id = coup.144 }
					any_plot_backer = {
						limit = { NOT = { character = FROM } }
						character_event = { id = coup.145 }
					}
				}
			}
		}
	}
}

# Coup fails due to intervention - inform target
character_event = {
	id = coup.143
	desc = "EVTDESCCOUP143"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP143"
		opinion = { who = FROMFROM modifier = opinion_attempted_coup }
	}
}

# Inform plot leader
letter_event = {
	id = coup.144
	desc = "EVTDESCCOUP144"
	show_from_from = yes
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP136"
		opinion = { who = FROMFROM modifier = opinion_failed_to_capture_coup_target }
		character_event = { id = coup.5500 tooltip = "EVTTOOLTIPCOUP5500" }
	}
}
# Inform other plot backers
character_event = {
	id = coup.145
	desc = "EVTDESCCOUP145"
	picture = GFX_evt_space_battle
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTCONFIRM"
	}
}
# Inform bystanders
character_event = {
	id = coup.146
	desc = "EVTDESCCOUP137"
	notification = yes
	is_triggered_only = yes
	
	option = { name = "EVTOPTCONFIRM" }
}

# MAIN COUP CONTROL EVENTS
# Initiate Coup
# Confirmation event for player
character_event = {
	id = coup.5000
	desc = "EVTDESCCOUP5000"
	picture = GFX_evt_cabal
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTCONFIRM"
		activate_plot = yes
		character_event = { id = coup.5001 tooltip = "EVTTOOLTIPCOUP5001" }
	}
	
	option = {
		name = "EVTOPTNEVERMIND"
		ai_chance = { factor = 0 }
	}
}
character_event = {
	id = coup.5001
	desc = "EVTDESCCOUP5001"
	picture = GFX_evt_cabal
	is_triggered_only = yes
	
	immediate = {
		# Set flags and diplomatic immunity
		set_character_flag = flag_coup_leader
		diplomatic_immunity = yes
		any_plot_backer = {
			set_character_flag = flag_coup_member
			diplomatic_immunity = yes
		}
	}
	
	# Send ultimatum immediately
	option = {
		trigger = {
			NOT = { has_character_flag = flag_coup_plan_military }
			NOT = {
				any_plot_backer = {
					OR = {
						has_character_flag = flag_coup_plan_military
					}
				}
			}
		}
		name = "EVTOPTACOUP5001"
		plot_target_char = { letter_event = { id = coup.5200 tooltip = "EVTTOOLTIP5200" } }
	}
	
	# Lead off with a military attack
	option = {
		trigger = {
			OR = {
				has_character_flag = flag_coup_plan_military
				any_plot_backer = { has_character_flag = flag_coup_plan_military }
			}
		}
		name = "EVTOPTBCOUP5001"
		if = {
			limit = { has_character_flag = flag_coup_plan_military }
			character_event = { id = coup.104 tooltip = "EVTTOOLTIPCOUP104" }
		}
		if = {
			limit = { NOT = { has_character_flag = flag_coup_plan_military } }
			# Grab a random military backer to lead the coup. Try to choose somebody not the worst.
			random_plot_backer = {
				limit = {
					has_character_flag = flag_coup_plan_military
					NOT = {
						ROOT = {
							any_plot_backer = {
								has_character_flag = flag_coup_plan_military
								attribute_diff = { character = PREVPREV attribute = martial value = 1 }
							}
							any_plot_backer = {
								has_character_flag = flag_coup_plan_military
								attribute_diff = { character = PREVPREV attribute = intrigue value = 1 }
							}
						}
					}
				}
				character_event = { id = coup.104 tooltip = "EVTTOOLTIPCOUP104" }
			}
		}
	}
}
# Resolve Captured Coup Target
character_event = {
	id = coup.5100
	hide_window = yes
	
	trigger = {
		OR = {
			has_plot = plot_coup
			has_plot = plot_justified_coup
		}
		plot_target_char = {
			prisoner = yes
			host = { character = ROOT }
		}
	}
	
	immediate = {
		plot_target_char = { character_event = { id = coup.5101 } }
	}
}
# Bounce to get target
character_event = {
	id = coup.5101
	desc = "EVTDESCCOUP5101"
	picture = GFX_evt_prison
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP5101"
		host = { character_event = { id = coup.5300 tooltip = "EVTTOOLTIP5300" } }
	}
}
# Coup Leader Delivers Ultimatum
letter_event = {
	id = coup.5200
	desc = "EVTDESCCOUP5200"
	is_triggered_only = yes
	
	option = {
		# Concede to demands
		name = "EVTOPTACCEPT"
		FROM = {
			letter_event = { id = coup.5201 tooltip = "EVTTOOLTIPCOUP5201" } # FROM will get all your titles
			any_plot_backer = { custom_tooltip = { text = "TOOLTIPBACKSCOUP" } } # List the plot backers
		}
		ai_chance = {
			factor = 10
			# Personality Effects
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = brave
			}
			modifier = {
				factor = 2
				trait = friendly
			}
			modifier = {
				factor = 0.5
				trait = cold
			}
			modifier = {
				factor = 4
				trait = content
			}
			modifier = {
				factor = 0.25
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
			
			modifier = {
				factor = 10
				trait = lunatic
			}
			
			# Plot Power Effects
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.1 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.2 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.3 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.4 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.5 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.6 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.7 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.8 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 0.9 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.1 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.2 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.3 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.4 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.5 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.6 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.7 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.8 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 1.9 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			modifier = {
				factor = 1.25
				FROM = { plot_power = 2 }
				NOT = { trait = imbecile }
				NOT = { trait = lunatic }
			}
			
			# Ideological Effects
			modifier = {
				factor = 0.8
				religion_authority = 0.1
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.2
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.3
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.4
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.5
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.6
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.7
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.8
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 0.9
				NOT = { trait = pragmatic }
			}
			modifier = {
				factor = 0.8
				religion_authority = 1
				NOT = { trait = pragmatic }
			}
		}
	}
	
	option = {
		# Reject Demands
		name = "EVTOPTREFUSE"
		FROM = { letter_event = { id = coup.5202 tooltip = "EVTTOOLTIP5202" } }
		ai_chance = { factor = 100 }
	}
}

# Plot Target accepts ultimatum - inform coup leader
letter_event = {
	id = coup.5201
	desc = "EVTDESCCOUP5201"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP5201"
		hidden_tooltip = { ROOT = { character_event = { id = coup.5300 } } }
	}
}

# Plot target rejects ultimatum - inform coup leader
letter_event = {
	id = coup.5202
	desc = "EVTDESCCOUP5202"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP5202" # Go to war
		# Clear out unnessecary flags and immunities
		hidden_tooltip = {
			diplomatic_immunity = no
			clr_character_flag = flag_coup_leader
			any_plot_backer = {
				diplomatic_immunity = no
				clr_character_flag = flag_coup_member
				# Also inform plot backers that war has started
				character_event = { id = coup.5203 }
				reverse_opinion = { who = FROM modifier = opinion_rebel_traitor }
			}
		}
		reverse_opinion = { who = FROM modifier = opinion_rebel_traitor }
		set_character_flag = flag_failed_coup
		set_character_flag = flag_launching_civil_war
		# Apply a moral authority penalty based on rank of liege's title
		if = {
			limit = { FROM = { primary_title = { tier = EMPEROR } } }
			religion_authority = { modifier = allowed_civil_war_empire years = 30 }
		}
		if = {
			limit = { FROM = { primary_title = { tier = KING } } }
			religion_authority = { modifier = allowed_civil_war_kingdom years = 30 }
		}
		if = {
			limit = { FROM = { primary_title = { tier = DUKE } } }
			religion_authority = { modifier = allowed_civil_war_duchy years = 30 }
		}
		if = {
			limit = { FROM = { primary_title = { tier = COUNT } } }
			religion_authority = { modifier = allowed_civil_war_county years = 30 }
		}
		# Start the war
		FROM = {
			hidden_tooltip = { character_event = { id = coup.5204 } } # Inform liege that war were declared
			reverse_war = {
				target = ROOT
				casus_belli = civil_war
				plot_backers = yes
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 0.5
				trait = friendly
			}
			modifier = {
				factor = 2
				trait = cold
			}
			modifier = {
				factor = 1.25
				plot_power = 0.1
			}
			modifier = {
				factor = 1.25
				plot_power = 0.2
			}
			modifier = {
				factor = 1.25
				plot_power = 0.3
			}
			modifier = {
				factor = 1.25
				plot_power = 0.4
			}
			modifier = {
				factor = 1.25
				plot_power = 0.5
			}
			modifier = {
				factor = 1.25
				plot_power = 0.6
			}
			modifier = {
				factor = 1.25
				plot_power = 0.7
			}
			modifier = {
				factor = 1.25
				plot_power = 0.8
			}
			modifier = {
				factor = 1.25
				plot_power = 0.9
			}
			modifier = {
				factor = 1.25
				plot_power = 1
			}
			modifier = {
				factor = 1.25
				plot_power = 1.1
			}
			modifier = {
				factor = 1.25
				plot_power = 1.2
			}
			modifier = {
				factor = 1.25
				plot_power = 1.3
			}
			modifier = {
				factor = 1.25
				plot_power = 1.4
			}
			modifier = {
				factor = 1.25
				plot_power = 1.5
			}
			modifier = {
				factor = 1.25
				plot_power = 1.6
			}
			modifier = {
				factor = 1.25
				plot_power = 1.7
			}
			modifier = {
				factor = 1.25
				plot_power = 1.8
			}
			modifier = {
				factor = 1.25
				plot_power = 1.9
			}
			modifier = {
				factor = 1.25
				plot_power = 2
			}
		}
	}
	
	option = {
		name = "EVTOPTBCOUP5203" # Don't go to war
		character_event = { id = coup.5400 tooltip = "EVTTOOLTIPCOUP5400" }
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = ambitious
			}
		}
	}
}
#5300	The coup was successful!
character_event = {
	id = coup.5300
	desc = "EVTDESCCOUP5300"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = {
		# This difference is just for flavor, but it's fun anyway
		trigger = {
			OR = {
				trait = content
				AND = {
					NOT = { trait = ambitious }
					NOT = { trait = pragmatic }
				}
			}
		}
		name = "EVTOPTACOUP5300"
		plot_target_char = {
			hidden_tooltip = {
				clr_character_flag = flag_failed_purge
				clr_character_flag = flag_launching_civil_war
				any_vassal = {
					clr_character_flag = flag_coup_intervener
					clr_character_flag = flag_coup_loyalist
				}
			}
			imprison = ROOT
			# Usurp titles using whatever event is appropriate
			character_event = { id = usurpation.0 tooltip = "EVTTOOLTIPUSURPATION0" }
			character_event = { id = usurpation.1 tooltip = "EVTTOOLTIPUSURPATION0" }
			character_event = { id = usurpation.2 tooltip = "EVTTOOLTIPUSURPATION0" }
			character_event = { id = coup.5301 tooltip = "EVTTOOLTIPCOUP5301" }
			hidden_tooltip = {
				any_realm_character = {
					limit = {
						NOT = { character = ROOT }
						NOT = { character = PREV }
						NOT = { any_backed_character = { character = ROOT } }
					}
					character_event = { id = coup.5303 }
				}
			}
		}
		hidden_tooltip = {
			diplomatic_immunity = no
			clr_character_flag = flag_coup_leader
			clr_character_flag = flag_coup_plan_military
			clr_character_flag = flag_coup_action_military
			clr_character_flag = flag_failed_coup
			clr_character_flag = flag_launching_civil_war
			any_plot_backers = {
				diplomatic_immunity = no
				clr_character_flag = flag_coup_member
				clr_character_flag = flag_coup_plan_military
				clr_character_flag = flag_coup_action_military
				clr_character_flag = flag_failed_coup
				character_event = { id = coup.5302 }
			}
		}
		set_character_flag = flag_successful_coup
	}
	
	option = {
		# This difference is just for flavor, but it's fun anyway
		trigger = {
			NOT = { trait = content }
			OR = {
				trait = ambitious
				trait = pragmatic
			}
		}
		name = "EVTOPTBCOUP5300"
		plot_target_char = {
			hidden_tooltip = {
				clr_character_flag = flag_failed_purge
				clr_character_flag = flag_launching_civil_war
				any_vassal = {
					clr_character_flag = flag_coup_intervener
					clr_character_flag = flag_coup_loyalist
				}
			}
			imprison = ROOT
			# Usurp titles using whatever event is appropriate
			character_event = { id = coup.5301 tooltip = "EVTTOOLTIPCOUP5301" }
			hidden_tooltip = {
				character_event = { id = usurpation.0 }
				character_event = { id = usurpation.1 }
				character_event = { id = usurpation.2 }
				any_realm_character = {
					limit = {
						NOT = { character = ROOT }
						NOT = { character = PREV }
						NOT = { any_backed_character = { character = ROOT } }
					}
					character_event = { id = coup.5303 }
				}
			}
		}
		hidden_tooltip = {
			diplomatic_immunity = no
			clr_character_flag = flag_coup_leader
			clr_character_flag = flag_coup_plan_military
			clr_character_flag = flag_coup_action_military
			clr_character_flag = flag_failed_coup
			clr_character_flag = flag_launching_civil_war
			any_plot_backers = {
				diplomatic_immunity = no
				clr_character_flag = flag_coup_member
				clr_character_flag = flag_coup_plan_military
				clr_character_flag = flag_coup_action_military
				clr_character_flag = flag_failed_coup
				character_event = { id = coup.5302 }
			}
		}
		set_character_flag = flag_successful_coup
	}
}
# Inform everyone that the coup was successful
character_event = {
	id = coup.5301
	desc = "EVTDESCCOUP5301"
	picture = GFX_evt_prison
	is_triggered_only = yes
	
	option = { name = "EVTOPTACOUP5301" }
}
character_event = {
	id = coup.5302
	desc = "EVTDESCCOUP5302"
	picture = GFX_evt_speech
	is_triggered_only = yes
	
	option = { name = "EVTOPTACOUP5302" }
}
character_event = {
	id = coup.5303
	desc = "EVTDESCCOUP5303"
	picture = GFX_evt_military_coup
	is_triggered_only = yes
	
	option = { name = "EVTOPTACOUP5303" }
}

# The coup failed
character_event = {
	id = coup.5400
	desc = "EVTDESCCOUP5400"
	picture = GFX_evt_prison
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTACOUP5400"
		# Clear out unnessecary flags and immunities
		hidden_tooltip = {
			diplomatic_immunity = no
			clr_character_flag = flag_coup_leader
			clr_character_flag = flag_coup_plan_military
			clr_character_flag = flag_coup_action_military
			clr_character_flag = flag_failed_coup
			clr_character_flag = flag_launching_civil_war
			any_plot_backer = {
				diplomatic_immunity = no
				clr_character_flag = flag_coup_member
				clr_character_flag = flag_coup_plan_military
				clr_character_flag = flag_coup_action_military
				clr_character_flag = flag_failed_coup
				# Also inform plot backers that their leader failed
				character_event = { id = coup.5402 }
				ROOT = { plot_target_char = { opinion = { who = PREVPREV modifier = opinion_traitor } } }
			}
		}
		plot_target_char = {
			opinion = { who = ROOT modifier = opinion_traitor }
			hidden_tooltip = {
				character_event = { id = coup.5401 }
				any_realm_character = {
					limit = {
						NOT = { character = ROOT }
						NOT = { character = PREV }
						NOT = { any_backed_character = { character = ROOT } }
					}
					character_event = { id = coup.5403 }
				}
			}
		}
		cancel_plot = plot_coup
		cancel_plot = plot_justified_coup
	}
}
#5500	Choose next coup action
character_event = {
	id = coup.5500
	desc = "EVTDESCCOUP5500"
	picture = GFX_evt_cabal
	is_triggered_only = yes
	
	# Send ultimatum immediately
	option = {
		trigger = {
			NOT = { has_character_flag = flag_coup_plan_military }
			NOT = {
				any_plot_backer = {
					OR = {
						has_character_flag = flag_coup_plan_military
					}
				}
			}
		}
		name = "EVTOPTACOUP5000"
		plot_target_char = { letter_event = { id = coup.5200 tooltip = "EVTTOOLTIP5200" } }
	}
	
	# Launch another military attack
	option = {
		trigger = {
			OR = {
				has_character_flag = flag_coup_plan_military
				any_plot_backer = { has_character_flag = flag_coup_plan_military }
			}
		}
		name = "EVTOPTACOUP5000"
		if = {
			limit = { has_character_flag = flag_coup_plan_military }
			character_event = { id = coup.117 tooltip = "EVTTOOLTIPCOUP117" }
		}
		if = {
			limit = { NOT = { has_character_flag = flag_coup_plan_military } }
			# Grab a random military backer to lead the coup. Try to choose somebody not the worst.
			random_plot_backer = {
				limit = {
					has_character_flag = flag_coup_plan_military
					NOT = {
						ROOT = {
							any_plot_backer = {
								has_character_flag = flag_coup_plan_military
								attribute_diff = { character = PREVPREV attribute = martial value = 1 }
							}
							any_plot_backer = {
								has_character_flag = flag_coup_plan_military
								attribute_diff = { character = PREVPREV attribute = intrigue value = 1 }
							}
						}
					}
				}
				character_event = { id = coup.117 tooltip = "EVTTOOLTIPCOUP117" }
			}
		}
	}
}